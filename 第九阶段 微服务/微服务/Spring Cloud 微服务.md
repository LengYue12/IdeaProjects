# Spring Cloud 微服务

# 第一部分 微服务架构

## 1）单体应用架构

把所有的功能都放在一个项目中，并部署在一个Tomcat容器中的架构就是单体应用架构



**优点：**

* 高效开发
* 架构简单
* 易于测试
* 易于部署

**缺点：**

* **可靠性差**：某个应用Bug，整个应用完蛋
* **复杂性高**：项目模块多，项目复杂
* **扩展能力受限**：单体应用只能作为一个整体进行扩展，无法根据业务模块的需要进行伸缩



## 2）垂直应用架构

把原有的单体应用拆分成多个项目。这样不同业务之间互不影响



**优点：**

* 系统拆分后实现了流量分担，解决了并发问题
* 可以针对不同模块进行优化
* 有容错率
* 系统间相互独立，互不影响

**缺点：**

* 服务之间相互调⽤，如果某个服务的端⼝或者ip地址发⽣改变，调⽤的系统得⼿动改变
* 搭建集群之后，实现负载均衡⽐较复杂，如：内⽹负载，在迁移机器时会影响调⽤⽅的路 由，导致线上故障
* 服务之间调⽤⽅式不统⼀，基于 httpclient 、 webservice ，接⼝协议不统⼀
* 服务监控不到位：除了依靠端⼝、进程的监控，调⽤的成功率、失败率、总耗时等等这些监 控指标是没有的



## 3）SOA应用架构

在做了垂直划分以后，模块随之增多，维护的成本在也变⾼，⼀些通⽤的业务和模块重复的越来越
多，为了解决上⾯提到的接⼝协议不统⼀、服务⽆法监控、服务的负载均衡，引⼊了阿⾥巴巴开源的
Dubbo ，⼀款⾼性能、轻量级的开源Java RPC框架，可以和Spring框架无缝集成。它提供了三⼤核⼼能⼒：**⾯向接⼝的远程⽅法调⽤，智能容错和负载均衡，以及服务⾃动注册和发现**



SOA (Service-Oriented Architecture)，即面向服务的架构（就是将整个项目进行拆分，拆分成一个一个服务，小项目）。根据实际业务，把系统拆分成合适
的、独立部署的模块，模块之间相互独立（通过Webservice/Dubbo等技术进行通信）。

* 优点：分布式、松耦合、扩展灵活、可重用。
* 缺点：服务抽取粒度较大、服务调用方和提供方耦合度较高（接口耦合度）





## 4）微服务应用架构

​	微服务架构可以说是SOA架构的一种拓展，这种架构模式下它拆**分粒度更小、服务更独立**。把应用
拆分成为一个个微小的服务，不同的服务可以使用不同的开发语言和存储，服务之间往往通过Restful等轻量级通信。微服务架构关键在于**微小、独立、轻量级通信**。
​	微服务是在 SOA 上做的升华粒度更加细致，微服务架构强调的⼀个重点是**业务需要彻底的组件化和服务化**



微服务架构和SOA架构很明显的一个区别就是**服务拆分粒度的不同**

微服务架构相对于SOA架构有两个特点：

* 服务拆分的粒度更细更小
* 使用Spring Cloud全家桶，进行服务治理，服务治理能力更强



## 微服务架构体现的思想及优缺点

​	核心思想就是**“微”**，拆分的粒度小，每个微服务的职责单一，耦合度降低，微小的功能可以独立部署，灵活性强，升级改造影响范围小。实现了整个应用的高可用

**微服务架构的优点：**

* 微服务很小，便于特定业务功能的聚焦
* 微服务很小，每个微服务都可以被一个小团队单独实施（开发、测试、部署上线、运维），团队合作一定程度解耦，便于实施敏捷开发
* 微服务很小，便于重用和模块之间的组装
* 微服务很独立，那么不同的微服务可以使用不同的语言开发，松耦合
* 微服务架构下，我们更容易引入新技术

**微服务架构的缺点：**

* 微服务架构下，分布式复杂难以管理，当服务数量增加，管理更复杂。服务治理的难度会增加
* 微服务架构下，分布式链路跟踪难等，调用链路长



## 微服务架构中的核心概念

* **服务注册与服务发现**

  职位搜索 --调用--》 简历服务

  服务提供者：简历服务

  服务消费者：职位搜索

**服务注册**：服务提供者将所提供的信息（IP和端口，服务访问协议等）注册到注册中心

**服务发现**：服务消费者**从注册中心获取到实时的服务列表**，然后根据一定的策略选择服务访问



* **负载均衡**

负载均衡即将请求压力分配到多个服务器（应用服务器、数据库服务器等），以此来提高服务的性能、可靠性



* **熔断**

熔断即断路保护。微服务架构中，如果下游服务因访问压力过大而响应变慢或失败，上游服务为了
保护系统整体可用性，可以暂时切断对下游服务的调用。这种牺牲局部，保全整体的措施就叫做熔断



* **链路追踪**

微服务架构越发流行，一个项目往往拆分成很多个服务，那么一次请求就需要涉及到很多个服务。不同的微服务可能是由不同的团队开发、可能使用不同的编程语言实现、整个项目也有可能部署在了很多服务器上（甚至百台、千台）横跨多个不同的数据中心。所谓链路追踪，就是对一次请求涉及的很多个服务链路**进行日志记录、性能监控**



* **API网关**





# 第二部分 Spring Cloud 

## Spring Cloud 是什么？

* **Spring Cloud是一系列框架的有序集合**（**Spring Cloud是一个规范**）

* 开发服务发现注册、配置中心、消息总线、负载均衡、断路器、数据监控等

* 利用Spring Boot的开发便利性简化了微服务架构的开发（自动装配）



这里，我们需要注意，**Spring Cloud其实是一套规范，是一套用于构建微服务架构的规范，而不是一个可以拿来即用的框架**（所谓规范就是应该有哪些功能组件，然后组件之间怎么配合，共同完成什么事情）。在这个规范之下第三方的Netflix公司开发了一些组件、Spring官方开发了一些框架/组件，包括第三方的阿里巴巴开发了一套框架/组件集合Spring Cloud Alibaba，这些才是Spring Cloud规范的实现。



Netflix搞了一套 ，简称SCN
Spring Cloud 吸收了Netflix公司的产品基础之上自己也搞了几个组件
阿里巴巴在之前的基础上搞出了一堆微服务组件,Spring Cloud Alibaba（SCA）





## Spring Cloud 能够解决什么问题？

​		Spring Cloud 规范及实现意图要解决的问题其实就是微服务架构实施过程中存在的一些问题，比如微服务架构中的服务注册发现问题、网络问题（比如熔断场景）、统一认证安全授权问题、负载均衡问题、链路追踪等问题。

* Distributed/versioned configuration （分布式/版本化配置）
  * 可以在分布式环境下做统一的管理，云端的配置改变了，各个微服务刷新
* Service registration and discovery （服务注册和发现）
* Routing （智能路由）
  * 网关
* Service-to-service calls （服务调用）
  * 服务之间互相调用，使用Feign组件统一HTTP协议调用，以接口的形式进行调用，解耦合
* Load balancing （负载均衡）
  * 集群访问，负载均衡
* Circuit Breakers （熔断器）
  * 保证服务的高可用
* Global locks （全局锁）
* Leadership election and cluster state （ 选举与集群状态管理）
* Distributed messaging （分布式消息传递平台）



## Spring Cloud架构

​	**Spring Cloud是一个微服务相关规范，这个规范意图为搭建微服务架构提供一站式服**
**务，采用组件（框架）化机制**定义一系列组件，各类组件针对性的处理微服务中的特定问题，这些组件共同来构成**Spring Cloud微服务技术栈**



## Spring Cloud 与 Dubbo 对比

* Dubbo是阿里巴巴开源的一个高性能的服务框架，基于RPC调用（远程调用，使用的协议是TCP，默认是TCP）。
* Spring Cloud Feign 是在Spring Cloud 全家桶中 进行远程调用的组件，基于HTTP协议调用的
* 根据OSI七层网路模型。基于TCP协议的Dubbo框架的效率是高于基于HTTP协议的 Spring Cloud Feign组件的
* 但是，Dubbo体系组件不全，不能够提供一站式解决方案，服务注册与发现中心要借助Zookeeper实现
* 而Spring Cloud 是提供了一站式服务化的解决方案，而且有Spring Cloud 全家桶



服务之间调用效率：Dubbo吊打Spring Cloud，因为使用的协议更加底层

技术生态，技术栈：Dubbo 需要依靠Zookeeper，而Spring Cloud 有丰富的组件



## Spring Cloud 与 Spring Boot 的关系

​		Spring Cloud 利用了 Spring Boot 的特点（依赖管理和自动配置），让我们能够快速的实现微服务组件开发。否则不使用Spring Boot的话，我们在使用Spring Cloud时，每一个组件的相关Jar包都需要我们自己导入配置以及需要开发人员考虑兼容性，还有大量的配置文件。

​		当整合了Spring Boot ，直接导入启动器，不需要考虑版本，因为有自动配置，所以不需要配置文件。

​		所以Spring Boot是我们快速把Spring Cloud微服务技术应用起来的一种方式。







