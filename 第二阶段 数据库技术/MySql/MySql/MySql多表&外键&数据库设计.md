# MySql多表&外键&数据库设计

## 1.多表

实际开发中，一个项目通常需要很多表来完成



## 1.4外键约束

可以让两张表之间产生一个对应的关系，从而保证了主从表引用的完整性。	

外键指的是在从表中与主表的主键对应的那个字段

主表和从表

​	主表 主键id所在的表，一的一方

​	从表 外键字段所在的表，多的一方

外键所在的表就是从表，外键所对应的主键的表叫主表



## 1.4.2 创建外键约束

添加外键约束的语法格式

​	1.创建表的时候添加外键

​	create table 表名(

​		字段...

​		[constraint] [外键约束名] foreign key(外键字段名) references 主表(主键字段)

);

添加外键约束之后 就会产生一个强制的外键约束检查，保证数据的完整性和一致性

​	2.已有表时添加外键

​	alter table 从表 add [constraint] [外键约束名] foreign key(外键字段名) references 主表(主键字段)

删除外键约束

​	语法格式	alter table 从表 drop foreign key (外键约束的名称)



## 1.4.4 外键约束的注意事项

1. 从表的外键类型必须与主表主键类型一致，否则创建失败
2. 添加数据时，应该先添加主表的数据
3. 删除数据的时候，要先删除从表中的数据



## 1.4.5级联删除

指的是在删除主表的数据的同时，可以删除与之相关的从表中的数据 

on delete cascade



# 2.多表关系设计

一对多关系：1:n 最常见的关系，员工对部门

多对的关系：n:n 用户与角色

一对一关系：1:1 身份证和人



一对多关系： 建表原则 	在多的一方建立外键	指向一的一方的主键

多对多关系：建表原则	需要创建第三张表 中间表至少要有两个字段，是两张表中的主键字段，作为中间的外键使用

一对一关系：可以在任意一方建立外键指向另一方的主键



# 3.多表查询

select 字段列表 from 表名列表;



交叉连接查询，会产生笛卡尔积，不会使用的

select 字段名 from 表1，表2;



## 3.4多表查询的分类

### 3.4.1内连接查询

通过指定的条件去匹配两张表的内容，匹配不上的就不显示

* 隐式内连接

​	select 字段名.. from 左表,右表 where 连接条件

多表查询中	可以使用给表起别名的方式 简化查询

​	

* 显式内连接

​	select 字段名.. from 左表 [inner] join 右表 on 连接条件



查询之前要确定的几件事情

​	1.查询几张表

​	2.表的连接条件

​	3.查询所用到的字段

​	4.查询的条件

### 3.4.2外连接查询

* 左外连接

​	语法格式	 left [outer] join

​	select 字段名 from 左表 left join 右表 on 连接条件

左外连接特点	以左表为基准	匹配右表中的数据	如果能匹配上就显示，如果匹配不上，左表中的数据正常显示，右表数据显示为null

* 右外连接

​		语法格式 right [outer] join

​	select 字段名 from 左表 right join 右表 on 连接条件

​	右外连接的特点	以右表为基准	匹配左表中的数据 如果能够匹配上就显示，如果匹配不到 右表中的数据就正常显示	左表显示null



## 3.4.3 各种连接方式的总结

* 内连接：inner join ，只获取两张表中 交集部分的数据
* 左外连接：left join， 以左表为基准，查询左表的所有数据，以及与右表有交集的部分
* 右外连接：right join，以右表为基准，查询右表的所有数据，以及与左表有交集的部分



# 4.子查询	

​	一条select 语句的结果，作为另外一条select语句的一部分

​	子查询的特点：

​		子查询必须要放在小括号中

​		子查询作为父查询的条件使用(更多的时候)

​	子查询的分类：

	* where型子查询：将子查询的结果，作为父查询的比较条件使用
	* from型子查询：将子查询的结果，作为一张表，提供给父层查询使用
	* exists型查询：查询结果是单列多行的情况，可以将子查询的结果作为父查询的 in函数中的条件使用 



## 4.2 子查询的结果作为查询条件

语法格式

​		select 查询字段 from 表 where 字段 = (子查询);



## 4.3子查询的结果作为一张表

语法格式

​	select 查询字段 from (子查询) 表别名 where 条件;

当子查询作为一张表的时候，需要起别名，否则无法访问表中的字段



## 4.4子查询结果是单列多行

作为父查询的 in 函数中的条件使用

语法格式

​	select 字段名 from 表名 where 字段 in(子查询);



## 4.5子查询总结

1. 子查询如果是一个字段(单列),那么就在where后面做条件
2. 如果是多个字段(多列),就当做一张表使用(要起别名)
2. 如果子查询的结果是单列多行就用in



# 5.数据库设计

##  5.1数据库三范式(空间最省)	三范式就是空间最省原则

​	三范式指的就是数据库设计的一个规则

​	作用	就是为了创建	冗余较小	结构合理的数据库

​	范式	就是设计数据库的要求(规范)

​	



## 5.1.1第一范式1NF

满足最低要求的范式

列具有原子性，设计列要做到不可拆分

## 5.1.2第二范式2NF

在满足第一范式的基础之上	进一步满足更多的规范

一张表只能描述一件事情

## 5.1.3第三范式3NF

以此类推

消除传递依赖

表中的信息如果能推导出来，就不要设计一个字段单独来记录



## 5.2数据库反三范式

指的是通过增加冗余或者重复数据	来提高数据库的读性能，浪费存储空间，节省查询时间(以空间换时间)



冗余字段	

​	某一个字段	属于一张表，但是	他又在多张表中都有出现





总结

	1. 尽量根据三范式规则去设计数据库
	2. 可以合理的加入冗余字段，减少 join 操作，让数据库执行的更快

