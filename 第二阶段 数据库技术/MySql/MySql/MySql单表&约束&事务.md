## MySql单表&约束&事务

## 1.DQL操作单表

## 1.2排序

通过order by 子句，将查询出的结果进行排序

select 字段名 from 表名 [where 字段 = 值] order by 字段名[asc / desc]

asc 升序排序(默认)

desc 降序排序



单列排序	按照某一个字段进行排序

组合排序	同时对多个字段进行排序，如果第一个字段相同 就按照第二个字段进行排序，以此类推

select 字段名 from 表名 order by 字段名 [asc/desc] , 字段名[asc/desc]



## 1.3聚合函数

将一列数据作为一个整体，进行纵向的计算

常用的聚合函数

​	count（字段） 统计记录数	在统计时会忽略空值

​	sum(字段) 求和操作

​	max(字段) 求最大值 

​	min（字段）求最小值

​	avg(字段)	求平均值



select 聚合函数(字段名) from 表名 [where 条件]



## 1.4分组查询

分组查询指的是使用 group by子句，对查询的信息进行分组，相同数据为一组

select 分组字段/聚合函数 from 表名 group by 分组字段[having 条件]

分组时可以查询要分组的字段，或者使用聚合函数进行统计操作，* 查询其他字段没有意义

需求：通过性别字段进行分组，求各组的平均薪资

select sex, avg(salary) from emp  group by sex;



在分组过后 进行条件过滤 使用having 判断条件

where 与 having 的区别

​	where 

 		1.在分组前进行过滤

​		 2.where后面不能跟 聚合函数

​	having

​		1.是在分组后进行条件过滤的

​		2.having后面可以写聚合函数



## 1.5 limit关键字

通过limit去指定要查询的数据的条数  行数

语法格式：

​	select 字段 from 表名 limit offset，length;

 参数说明：

​	offset：起始行数	默认从0开始计数

​	length：返回的行数(要查询几条数据)

分页公式 起始索引 = (当前页 - 1) * 每页条数 



# SQL约束

约束	

​	约束是指对数据进行一定的限制，来保证数据的完整性	有效性	正确性

常见的约束

​	主键约束 primary key 

​	唯一约束 unique

​	非空约束 not null

​	外键约束 foreign key

## 2.1主键约束

特点	不可重复	唯一	非空	

作用	用来表示数据库中的每一条记录



语法格式

​	字段名 字段类型 primary key 

通过DDL语句	添加主键约束

alter table 表名 add primary key(字段名);

删除主键	DDL语句

alter table 表名 drop primary key;



主键的自增

​	auto_increment	主键的自动增长(字段类型必须是 整数类型)





delete和truncate对自增的影响

删除表中所有数据的方式

delete        只是删除表中所有数据，对自增没有影响

truncate	是将整个表删除掉，然后创建一个新的表，自增的主键，重新从1开始



## 2.2非空约束

特点：某一列不允许为空

语法格式：

​	字段名 字段类型 not null



## 2.3唯一约束

特点：表中的某一列不能够重复(对null不做唯一判断)

语法格式：

​	字段名 字段类型 unique

主键约束和唯一约束的区别

1.主键约束	唯一且不能够为空

2.唯一约束	唯一 但是可以为空

3.一个表中只能有一个主键，但是可以有多个唯一约束



## 2.5默认值

默认值约束	用来指定某列的默认值

语法格式：

​	字段名 字段类型 default 默认值



# 3.数据库事务

事务是一个整体，由一条或多条SQL语句组成，这些SQL语句要么执行成功，要么执行失败，只要有一条SQL出现异常，整个操作就会回滚，整个业务执行失败

回滚	即在事务运行过程中发生了某种故障，事务不能继续执行，系统将事务中对数据库的所有已完成的操作全部撤销，滚回到事务开始的状态

## 手动提交事务

1.开启事务	start transaction begin;

2.提交事务	commit;

3.回滚事务	rollback;



自动提交事务

​	MySql默认提交方式	自动提交事务

​	每执行一条DML语句	都是一个单独的事务



事务的四大特性

原子性 

​		每个事务都是一个整体，不可再拆分，事务中所有的SQL语句要么执行成功，要么执行失败

一致性

​		事务在执行前数据库的状态与执行后数据库的状态保持一致

隔离性

​		事务与事务之间不应该相互影响，执行时保持隔离的状态

持久性

​		一旦事务执行成功，对数据库的修改时持久的。



## 3.5 MySql 事务隔离级别

​	多个事务访问同一批数据时，有可能会发生一些问题

​	并发访问的问题

​	脏读	一个事务读取到了另一个事务没有提交的数据

​	不可重复读	一个事务中	两次读取到的数据不一致

​	幻读	一个事务中，一次查询的结果，无法支撑后续的业务操作

​	可以通过设置隔离级别

​		read uncommitted：读未提交

​			可以防止哪些问题：无

​		read committed:	读已提交(Oracle默认 隔离级别)

​			可以防止：脏读

​		repeatable	read：	可重复读(MySql默认的隔离级别)

​			可以防止：脏读，不可重复读

​		serializable: 			串行化

​			可以防止：脏读，不可重复读，幻读



注意：隔离级别	从小到大	安全性是越来越高的，但是效率是越来越低的，根据不同的情况选择对应的隔离级别



## 隔离级别的相关命令

1.查看隔离级别

​	select @@tx_isolation;



2.设置隔离级别

​	set global transaction isolation level 级别名称;

 
